<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công cụ tính Thuế TNCN Đa năng</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f1f5f9; }
        .bg-primary { background-color: #ff6000; }
        .text-primary { color: #ff6000; }
        .sidebar-item { transition: all 0.3s; cursor: pointer; border-left: 4px solid transparent; }
        .sidebar-item.active { background-color: #fff7ed; border-left-color: #ff6000; color: #ff6000; font-weight: bold; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .input-box { border: 1px solid #d1d5db; border-radius: 6px; padding: 8px 12px; outline: none; width: 100%; text-align: right; }
        .input-box:focus { border-color: #ff6000; ring: 1px solid #ff6000; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">

    <div class="w-full md:w-72 bg-white shadow-lg z-10">
        <div class="p-6 border-b">
            <h1 class="text-xl font-bold text-gray-800 flex items-center">
                <i class="fa-solid fa-calculator text-primary mr-2"></i> THUẾ TNCN
            </h1>
        </div>
        <nav class="mt-4">
            <div onclick="showTab('net')" id="menu-net" class="sidebar-item active p-4 flex items-center hover:bg-gray-50">
                <i class="fa-solid fa-wallet w-8 text-center"></i> 1. Tính từ lương NET
            </div>
            <div onclick="showTab('gross')" id="menu-gross" class="sidebar-item p-4 flex items-center hover:bg-gray-50">
                <i class="fa-solid fa-money-bill-trend-up w-8 text-center"></i> 2. Tính từ lương GROSS
            </div>
            <div onclick="showTab('refund')" id="menu-refund" class="sidebar-item p-4 flex items-center hover:bg-gray-50">
                <i class="fa-solid fa-hand-holding-dollar w-8 text-center"></i> 3. Quyết toán hoàn thuế
            </div>
        </nav>
        <div class="p-6 mt-10 text-xs text-gray-400 italic">
            * Dữ liệu tính toán dựa trên quy định thuế hiện hành.
        </div>
    </div>

    <div class="flex-1 p-4 md:p-10 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
            
            <div id="tab-net" class="tab-content space-y-6">
                <div class="card p-6 md:p-8">
                    <h2 class="text-lg font-bold mb-6 text-gray-700 border-b pb-2 italic">Cách 1: Tính dựa trên mức lương NET (Theo tháng)</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                        <div class="space-y-4">
                            <div class="flex items-center justify-between gap-4">
                                <label class="text-sm font-medium text-gray-600"><i class="fa-solid fa-coins mr-1"></i> Tổng thu nhập (NET) *</label>
                                <input type="number" id="net-income" value="15000000" oninput="calcNet()" class="input-box max-w-[180px]">
                            </div>
                            <div class="flex items-center justify-between gap-4">
                                <label class="text-sm font-medium text-gray-600"><i class="fa-solid fa-users mr-1"></i> Số người phụ thuộc *</label>
                                <input type="number" id="net-deps" value="0" oninput="calcNet()" class="input-box max-w-[180px]">
                            </div>
                            <p class="text-[11px] text-gray-400 italic mt-2">Ô đánh dấu * bắt buộc điền dữ liệu</p>
                        </div>
                        <div class="bg-orange-50 p-6 rounded-xl border border-orange-200 text-center">
                            <span class="block text-sm text-orange-600 font-bold mb-1">Số thuế TNCN cần nộp:</span>
                            <span id="net-result" class="text-3xl font-bold text-primary">0</span> <span class="text-primary font-bold">VNĐ</span>
                        </div>
                    </div>
                </div>
                <div id="desc-net" class="card p-6 bg-gray-50 border border-gray-200 font-mono text-sm space-y-2"></div>
            </div>

            <div id="tab-gross" class="tab-content hidden space-y-6">
                <div class="card p-6 md:p-8">
                    <h2 class="text-lg font-bold mb-6 text-gray-700 border-b pb-2 italic">Cách 2: Tính dựa trên mức lương GROSS (Theo tháng)</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="flex items-center justify-between gap-4">
                                <label class="text-sm font-medium text-gray-600">Tổng thu nhập (GROSS) *</label>
                                <input type="number" id="gross-income" value="18000000" oninput="calcGross()" class="input-box max-w-[180px]">
                            </div>
                            <div class="flex items-center justify-between gap-4">
                                <label class="text-sm font-medium text-gray-600">Mức lương đóng BH *</label>
                                <input type="number" id="gross-bh" value="18000000" oninput="calcGross()" class="input-box max-w-[180px]">
                            </div>
                            <div class="flex items-center justify-between gap-4">
                                <label class="text-sm font-medium text-gray-600">Số người phụ thuộc *</label>
                                <input type="number" id="gross-deps" value="0" oninput="calcGross()" class="input-box max-w-[180px]">
                            </div>
                        </div>
                        <div class="bg-blue-50 p-6 rounded-xl border border-blue-200 text-center flex flex-col justify-center">
                            <span class="block text-sm text-blue-600 font-bold mb-1">Số thuế TNCN cần nộp:</span>
                            <span id="gross-result" class="text-3xl font-bold text-blue-700">0</span> <span class="text-blue-700 font-bold">VNĐ</span>
                        </div>
                    </div>
                </div>
                <div id="desc-gross" class="card p-6 bg-gray-50 border border-gray-200 font-mono text-sm space-y-2"></div>
            </div>

            <div id="tab-refund" class="tab-content hidden space-y-6">
                <div class="card p-6 md:p-8">
                    <h2 class="text-lg font-bold mb-6 text-gray-700 border-b pb-2 italic">Bảng tính số tiền thuế TNCN được hoàn (Theo năm)</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-3">
                            <div class="flex flex-col"><label class="text-xs font-bold text-gray-500">TỔNG THU NHẬP (GROSS) *</label><input type="number" id="ref-gross" value="216000000" oninput="calcRefund()" class="input-box"></div>
                            <div class="flex flex-col"><label class="text-xs font-bold text-gray-500">TỔNG BẢO HIỂM ĐÃ ĐÓNG *</label><input type="number" id="ref-bh" value="22680000" oninput="calcRefund()" class="input-box"></div>
                            <div class="flex flex-col"><label class="text-xs font-bold text-gray-500">SỐ THUẾ ĐÃ KHẤU TRỪ (ĐÃ NỘP) *</label><input type="number" id="ref-paid" value="1000000" oninput="calcRefund()" class="input-box"></div>
                        </div>
                        <div class="space-y-3">
                            <div class="flex flex-col"><label class="text-xs font-bold text-gray-500">SỐ NGƯỜI PHỤ THUỘC</label><input type="number" id="ref-deps" value="0" oninput="calcRefund()" class="input-box"></div>
                            <div class="flex flex-col"><label class="text-xs font-bold text-gray-500">SỐ THÁNG PHỤ THUỘC</label><input type="number" id="ref-months" value="0" oninput="calcRefund()" class="input-box"></div>
                            <div id="refund-status-box" class="p-4 rounded-lg text-sm mt-4 font-bold border"></div>
                        </div>
                    </div>
                </div>
                <div id="desc-refund" class="card p-6 bg-gray-50 border border-gray-200 font-mono text-sm space-y-2"></div>
            </div>

        </div>
    </div>

    <script>
        const format = (n) => new Intl.NumberFormat('vi-VN').format(Math.round(n));

        function showTab(tabId) {
            // Ẩn tất cả nội dung
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            // Hiện nội dung được chọn
            document.getElementById('tab-' + tabId).classList.remove('hidden');
            // Cập nhật Menu
            document.querySelectorAll('.sidebar-item').forEach(m => m.classList.remove('active'));
            document.getElementById('menu-' + tabId).classList.add('active');
        }

        function getTax(taxable) {
            if (taxable <= 0) return 0;
            if (taxable <= 5000000) return taxable * 0.05;
            if (taxable <= 10000000) return taxable * 0.1 - 250000;
            if (taxable <= 18000000) return taxable * 0.15 - 750000;
            if (taxable <= 32000000) return taxable * 0.2 - 1650000;
            if (taxable <= 52000000) return taxable * 0.25 - 3250000;
            if (taxable <= 80000000) return taxable * 0.3 - 5850000;
            return taxable * 0.35 - 9850000;
        }

        // TÍNH NET
        function calcNet() {
            const income = parseFloat(document.getElementById('net-income').value) || 0;
            const deps = parseInt(document.getElementById('net-deps').value) || 0;
            const taxable = Math.max(0, income - 11000000 - (deps * 4400000));
            const tax = getTax(taxable);
            
            document.getElementById('net-result').innerText = format(tax);
            document.getElementById('desc-net').innerHTML = `
                <div>Giảm trừ bản thân: = 11.000.000</div>
                <div>Giảm trừ người phụ thuộc: = 4.400.000 x ${deps} = ${format(deps * 4400000)}</div>
                <div class="font-bold text-blue-600">Tổng thu nhập tính thuế: = ${format(income)} - 11.000.000 - ${format(deps*4400000)} = ${format(taxable)}</div>
                <div class="font-bold text-primary">Số thuế TNCN cần nộp: = ${format(taxable)} x ... = ${format(tax)}</div>
            `;
        }

        // TÍNH GROSS
        function calcGross() {
            const income = parseFloat(document.getElementById('gross-income').value) || 0;
            const bhLương = parseFloat(document.getElementById('gross-bh').value) || 0;
            const deps = parseInt(document.getElementById('gross-deps').value) || 0;

            const bhxh = bhLương * 0.08;
            const bhyt = bhLương * 0.015;
            const bhtn = bhLương * 0.01;
            const totalBH = bhxh + bhyt + bhtn;
            
            const taxable = Math.max(0, income - totalBH - 11000000 - (deps * 4400000));
            const tax = getTax(taxable);

            document.getElementById('gross-result').innerText = format(tax);
            document.getElementById('desc-gross').innerHTML = `
                <div>BHXH (8%): ${format(bhxh)} | BHYT (1.5%): ${format(bhyt)} | BHTN (1%): ${format(bhtn)}</div>
                <div>Giảm trừ bản thân: 11.000.000</div>
                <div class="font-bold text-blue-600">Thu nhập tính thuế: = ${format(income)} - ${format(totalBH)} - 11.000.000 - ... = ${format(taxable)}</div>
                <div class="font-bold text-blue-700">Số thuế phải nộp: ${format(tax)}</div>
            `;
        }

        // QUYẾT TOÁN HOÀN THUẾ
        function calcRefund() {
            const gross = parseFloat(document.getElementById('ref-gross').value) || 0;
            const bh = parseFloat(document.getElementById('ref-bh').value) || 0;
            const paid = parseFloat(document.getElementById('ref-paid').value) || 0;
            const deps = parseInt(document.getElementById('ref-deps').value) || 0;
            const months = parseInt(document.getElementById('ref-months').value) || 0;

            const totalGiaCanh = 132000000 + (deps * months * 4400000);
            const taxableYear = Math.max(0, gross - bh - totalGiaCanh);
            const taxMonth = getTax(taxableYear / 12);
            const taxYear = taxMonth * 12;
            const refund = paid - taxYear;

            const box = document.getElementById('refund-status-box');
            if(refund >= 0) {
                box.className = "p-4 rounded-lg text-sm mt-4 font-bold border border-green-200 bg-green-50 text-green-700";
                box.innerHTML = `<i class="fa-solid fa-circle-check"></i> Bạn được hoàn thuế: ${format(refund)} VNĐ`;
            } else {
                box.className = "p-4 rounded-lg text-sm mt-4 font-bold border border-red-200 bg-red-50 text-red-700";
                box.innerHTML = `<i class="fa-solid fa-circle-xmark"></i> Bạn cần nộp thêm: ${format(Math.abs(refund))} VNĐ`;
            }

            document.getElementById('desc-refund').innerHTML = `
                <div>Thu nhập tính thuế năm: ${format(taxableYear)}</div>
                <div>Thuế phải nộp trung bình tháng: ${format(taxMonth)}</div>
                <div class="font-bold">Tổng thuế phải nộp cả năm: ${format(taxYear)}</div>
                <div class="font-bold text-orange-600">Kết quả (Đã nộp - Phải nộp): ${format(paid)} - ${format(taxYear)} = ${format(refund)}</div>
            `;
        }

        // Khởi tạo
        window.onload = () => {
            calcNet();
            calcGross();
            calcRefund();
        };
    </script>
</body>
</html>
